{
  flux: {
    enabled: true,
    managerFilePatterns: ['flux/**/*.{yaml,yml}'],
  },
  kubernetes: {
    managerFilePatterns: ['**/*.{yaml,yml}'],
    ignorePaths: ['**/kustomization.{yaml,yml}', 'flux/flux-system/gotk*.{yaml,yml}'],
  },
  extends: [
    'config:recommended',
    ':enablePreCommit',
  ],
  automerge: false,
  timezone: 'America/Indiana/Indianapolis',
  assignees: ['jeversol'],
  packageRules: [
    {
      matchPackageNames: ['renovatebot/pre-commit-hooks', 'renovate/renovate'],
      groupName: 'renovate',
      matchUpdateTypes: ['patch', 'minor'],
      schedule: ['* 0-4 * * 1'],
      automerge: true,
      assignees: [],
    },
    {
      matchPackageNames: ['gitguardian/ggshield'],
      matchManagers: ['pre-commit'],
      matchUpdateTypes: ['patch', 'minor'],
      automerge: true,
      assignees: [],
    },
    {
      matchManagers: ['github-actions'],
      automerge: true,
      matchUpdateTypes: ['patch', 'minor'],
      schedule: ['* 0-4 * * 1'],
      assignees: [],
    },
    {
      matchUpdateTypes: ['patch'],
      matchDatasources: ['docker', 'helm'],
      automerge: true,
      assignees: [],
      matchPackageNames: ['!kube-prometheus-stack'],
    },
    {
      matchFileNames: ['tools/cluster-multitool/Dockerfile'],
      matchUpdateTypes: ['patch'],
      matchDatasources: ['repology', 'pypi'],
      automerge: true,
      assignees: [],
    },
    {
      matchPackageNames: ['ghcr.io/jeversol/cluster-multitool'],
      matchUpdateTypes: ['digest', 'pin'],
      pinDigests: true,
      automerge: true,
      assignees: [],
    },
    {
      matchDatasources: ['docker'],
      matchPackageNames: ['homebridge/homebridge'],
      versioning: 'regex:^(?<major>\\d{4})-(?<minor>\\d{2})-(?<patch>\\d{2})$',
      allowedVersions: '/^\\d{4}-\\d{2}-\\d{2}$/',
    },
    {
      matchPackageNames: ['ghcr.io/analogj/scrutiny'],
      groupName: 'scrutiny',
      pinDigests: true,
      separateMinorPatch: true,
    },
    {
      matchPackageNames: [
        'ghcr.io/home-operations/plex',
        'ghcr.io/home-operations/sonarr',
        'ghcr.io/home-operations/radarr',
        'ghcr.io/home-operations/prowlarr',
      ],
      pinDigests: true,
      matchUpdateTypes: ['patch', 'minor', 'digest'],
      automerge: true,
      automergeSchedule: ['* 5-8 * * *'],
      assignees: [],
    },
    {
      matchPackageNames: ['kube-prometheus-stack'],
      matchDatasources: ['helm'],
      matchUpdateTypes: ['patch', 'minor'],
      automerge: true,
      assignees: [],
    },
    {
      matchPackageNames: ['siderolabs/talos', 'ghcr.io/siderolabs/talosctl'],
      groupName: 'talos',
      minimumReleaseAge: '3 days',
      automerge: false,
      assignees: ['jeversol'],
    },
    // IMPORTANT: Kubernetes Component Version Management
    // The kubernetes-components group tracks k8s control plane images in tools/cluster/base-controlplane.yaml.
    // The allowedVersions constraint is tied to the Talos support matrix.
    //
    // When upgrading Talos to a new minor version:
    // 1. Check support matrix: https://docs.siderolabs.com/talos/getting-started/support-matrix/
    // 2. Update allowedVersions below to match supported k8s versions
    //    Example: Talos 1.11.x supports k8s 1.34.x only -> '/^v1\\.34\\./'
    //    Example: Talos 1.12.x might support k8s 1.34.x and 1.35.x -> '/^v1\\.(34|35)\\./'
    // 3. Current: Talos 1.11.x supports Kubernetes 1.34.x
    {
      matchPackageNames: [
        'ghcr.io/siderolabs/kubelet',
        'registry.k8s.io/kube-apiserver',
        'registry.k8s.io/kube-controller-manager',
        'registry.k8s.io/kube-proxy',
        'registry.k8s.io/kube-scheduler',
      ],
      groupName: 'kubernetes-components',
      allowedVersions: '/^v1\\.34\\./',
      minimumReleaseAge: '7 days',
      automerge: false,
      assignees: ['jeversol'],
    },
    {
      matchPackageNames: ['kubernetes-sigs/node-feature-discovery'],
      overrideDatasource: 'github-releases',
    },
  ],
  customManagers: [
    {
      customType: 'regex',
      managerFilePatterns: ['/tools/cluster-multitool/Dockerfile/'],
      matchStrings: [
        '#\\s*renovate:\\s*datasource=(?<datasource>.*?) depName=(?<depName>.*?)( versioning=(?<versioning>.*?))?\\sENV .*?_VERSION=\"(?<currentValue>.*)\"\\s',
      ],
      versioningTemplate: '{{#if versioning}}{{{versioning}}}{{else}}semver{{/if}}',
    },
    {
      customType: 'regex',
      managerFilePatterns: ['/infrastructure/system-upgrade-controller/plans/plans\\.yaml/'],
      matchStrings: [
        'version:\\s*(?<currentValue>\\S+)\\s*#\\s*renovate:\\s*datasource=(?<datasource>\\S+)\\s+depName=(?<depName>\\S+)(?:\\s+versioning=(?<versioning>\\S+))?',
      ],
      versioningTemplate: '{{#if versioning}}{{{versioning}}}{{else}}semver{{/if}}',
    },
    {
      customType: 'regex',
      managerFilePatterns: ['^flux/flux-system/flux-instance\\.yaml$'],
      matchStrings: [
        'version:\\s+"(?<currentValue>\\d+\\.\\d+)\\.x"',
      ],
      datasourceTemplate: 'github-releases',
      depNameTemplate: 'fluxcd/flux2',
      extractVersionTemplate: '^v(?<version>\\d+\\.\\d+)',
    },
    {
      customType: 'regex',
      managerFilePatterns: ['^tools/cluster/base-controlplane\\.yaml$'],
      matchStrings: [
        '\\s+image:\\s+(?<depName>[^:]+):v(?<currentValue>\\d+\\.\\d+\\.\\d+)',
      ],
      datasourceTemplate: 'docker',
      versioningTemplate: 'semver',
    },
  ],
}
