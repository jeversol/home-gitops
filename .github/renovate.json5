{
  extends: [
    'config:recommended',
    ':enablePreCommit',
  ],
  automerge: false,
  timezone: 'America/Indiana/Indianapolis',
  assignees: [
    'jeversol',
  ],
  flux: {
    enabled: true,
    managerFilePatterns: [
      'flux/**/*.{yaml,yml}',
    ],
  },
  kubernetes: {
    managerFilePatterns: [
      '**/*.{yaml,yml}',
      '!**/kustomization.{yaml,yml}',
      '!flux/flux-system/gotk*.{yaml,yml}',
    ],
  },
  packageRules: [
    {
      matchPackageNames: ['renovatebot/pre-commit-hooks'],
      automerge: true,
      automergeType: 'pr',
      matchUpdateTypes: ['patch', 'minor'],
      schedule: ['* 2 * * *'],
      assignees: [],
    },
    {
      // Auto-merge patch updates for container images and charts
      matchUpdateTypes: ['patch'],
      matchDatasources: ['docker', 'helm'],
      automerge: true,
      automergeType: 'pr',
      assignees: [],
    },
    {
      // NEVER automerge Talos/Kubernetes version updates - these require manual intervention
      matchFileNames: ['infrastructure/cluster/track-versions.yaml'],
      automerge: false,
    },
    {
      // Auto-merge patch and minor updates for cluster-multitool Dockerfile dependencies
      matchFileNames: ['tools/cluster-multitool/Dockerfile'],
      matchUpdateTypes: ['patch', 'minor'],
      automerge: true,
      automergeType: 'pr',
      assignees: [],
    },
    {
      // Auto-merge digest pins for cluster-multitool container images
      matchPackageNames: ['ghcr.io/jeversol/cluster-multitool'],
      matchUpdateTypes: ['digest', 'pin'],
      pinDigests: true,
      automerge: true,
      automergeType: 'pr',
      assignees: [],
    },
    {
      matchDatasources: ['docker'],
      matchPackageNames: ['homebridge/homebridge'],
      versioning: 'regex:^(?<major>\\d{4})-(?<minor>\\d{2})-(?<patch>\\d{2})$',
      allowedVersions: '/^\\d{4}-\\d{2}-\\d{2}$/',
    },
    {
      matchPackageNames: ['ghcr.io/analogj/scrutiny'],
      pinDigests: true,
      separateMinorPatch: true,
    },
    {
      // Home-operations containers - auto-merge patch/minor updates at 5am
      matchPackageNames: [
        'ghcr.io/home-operations/plex',
        'ghcr.io/home-operations/sonarr',
        'ghcr.io/home-operations/radarr',
        'ghcr.io/home-operations/prowlarr'
      ],
      pinDigests: true,
      matchUpdateTypes: ['patch', 'minor', 'digest'],
      automerge: true,
      automergeType: 'pr',
      schedule: ['* 5 * * *'],
      assignees: [],
    },
  ],
  customManagers: [
    {
      customType: 'regex',
      managerFilePatterns: [
        'infrastructure/cluster/track-versions.yaml',
      ],
      matchStrings: [
        'talosVersion:\\s+v?(?<currentValue>\\d+\\.\\d+\\.\\d+)',
      ],
      datasourceTemplate: 'github-releases',
      depNameTemplate: 'talos-systems/talos',
      versioningTemplate: 'semver',
    },
    {
      customType: 'regex',
      managerFilePatterns: [
        'infrastructure/cluster/track-versions.yaml',
      ],
      matchStrings: [
        'kubernetesVersion:\\s+v?(?<currentValue>\\d+\\.\\d+\\.\\d+)',
      ],
      datasourceTemplate: 'github-tags',
      depNameTemplate: 'kubernetes/kubernetes',
      versioningTemplate: 'semver',
    },
    {
      customType: 'regex', 
      managerFilePatterns: [
        'tools/cluster-multitool/Dockerfile',
      ],
      matchStrings: [
        '#\\s*renovate:\\s*datasource=(?<datasource>.*?) depName=(?<depName>.*?)( versioning=(?<versioning>.*?))?\\sENV .*?_VERSION=\"(?<currentValue>.*)\"\\s'
      ],
      versioningTemplate: '{{#if versioning}}{{{versioning}}}{{else}}semver{{/if}}',
    },
    {
      // System Upgrade Controller Plans - Talos versions in upgrade commands
      customType: 'regex',
      managerFilePatterns: [
        'infrastructure/system-upgrade-controller/upgrade-plans.yaml',
      ],
      matchStrings: [
        'talosctl:v(?<currentValue>\\d+\\.\\d+\\.\\d+)',
        'factory\\.talos\\.dev/installer/[^:]+:v(?<currentValue>\\d+\\.\\d+\\.\\d+)',
        'upgrade.*--image.*factory\\.talos\\.dev/installer/[^:]+:v(?<currentValue>\\d+\\.\\d+\\.\\d+)'
      ],
      datasourceTemplate: 'github-releases',
      depNameTemplate: 'siderolabs/talos',
      versioningTemplate: 'semver',
    },
    {
      // System Upgrade Controller Plans - Kubernetes versions in upgrade commands  
      customType: 'regex',
      managerFilePatterns: [
        'infrastructure/system-upgrade-controller/upgrade-plans.yaml',
      ],
      matchStrings: [
        '--to v(?<currentValue>\\d+\\.\\d+\\.\\d+)'
      ],
      datasourceTemplate: 'github-tags',
      depNameTemplate: 'kubernetes/kubernetes', 
      versioningTemplate: 'semver',
    },
  ],
}
